<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title th:text="${ricetta.titolo}">Dettagli Ricetta</title>
  
  <!-- Collegamento al CSS -->
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="recipe-detail-container">

    <h1 th:text="${ricetta.titolo}">Titolo</h1>


	

	<div class="ricetta-immagine" th:if="${ricetta.nomeImmagine != null}">
	    <img th:src="@{'/images/' + ${ricetta.nomeImmagine}}"
	         alt="Foto della ricetta"
	         style="max-width: 400px; border-radius: 10px; margin: 20px 0;">
	</div>

  

    <p th:text="${ricetta.descrizione}">Descrizione breve</p>
	
	<div class="recipe-columns">

	    <div class="colonna-ingredienti">
	        <p class="section-title">Ingredienti</p>
	        <ul class="ingredienti-list">
	            <li th:each="ing : ${ricetta.ingredienti}">
	                <strong th:text="${ing.nome}"></strong> :
	                <span th:text="${ing.quantita}"></span>
	                <span th:text="${ing.unita}"></span>
	            </li>
	        </ul>
	    </div>

	    <div class="colonna-procedimento">
	        <p class="section-title">Procedimento</p>
	        <p th:text="${ricetta.procedimento}"></p>
	    </div>

	</div>

    <p><strong>Tempo:</strong> <span th:text="${ricetta.tempo}">Tempo</span> minuti</p>

    <p><strong>Difficoltà:</strong> <span th:text="${ricetta.difficolta}">Difficoltà</span></p>

    <p><strong>Categoria:</strong> <span th:text="${ricetta.categoria}">Categoria</span></p>

    <p><strong>Autore:</strong> <a th:href="@{'/autore/' + ${ricetta.autore.id}}" th:text="${ricetta.autore.nome}">Autore</a></p>

    <p><strong>Data:</strong> 
       <span th:text="${#dates.format(ricetta.data, 'dd/MM/yyyy')}">Data</span>
    </p>

	  <!-- Link "Aggiungi recensione" visibile solo se utente loggato e NON bannato -->
		<div th:if="${utenteLoggato != null and utenteLoggato.stato != 'BANNATO'}">
			<a th:href="@{'/ricetta/' + ${ricetta.id} + '/recensione/new'}"
			class="add-review-button">
			Aggiungi recensione
			</a>
	    </div>


	  <!-- Pulsante MODIFICA visibile solo ad ADMIN o autore -->
		<div th:if="${ruolo == 'ADMIN' 
		            or (ruolo == 'USER' 
		                and utenteLoggato.stato == 'ATTIVO' 
		                and ricetta.autore.id == utenteLoggatoId)}">

		    <a th:href="@{'/ricetta/' + ${ricetta.id} + '/edit'}" 
		       class="btn btn-warning">
		        Modifica
		    </a>

		</div>
	  
	  
	<!-- Pulsante ELIMINA visibile solo ad ADMIN o autore -->
	<div th:if="${ruolo == 'ADMIN' or utenteLoggatoId == ricetta.autore.id}">
	    <a th:href="@{'/ricetta/delete/' + ${ricetta.id}}" class="delete-button">
	        Elimina ricetta
	    </a>
	</div>

	  <p class="section-title">Recensioni</p>

	<div th:if="${ricetta.recensioni != null and #lists.isEmpty(ricetta.recensioni) == false}">
	    
	    <div class="recensione" th:each="rec : ${ricetta.recensioni}">
	        
	        <p>
	            <strong th:text="${rec.autore.nome}">Autore</strong>
	            -
	            <span th:text="${#dates.format(rec.data, 'dd/MM/yyyy')}">Data</span>
	        </p>

			<p class="rec-stars">
			    <span th:each="i : ${#numbers.sequence(1, rec.voto)}">⭐</span>
			</p>

	        <p th:text="${rec.testo}">Testo recensione</p>

	        <!-- Link ELIMINA recensione: visibile solo ad autore o admin -->
	        <a th:if="${(ruolo == 'ADMIN') or (utenteLoggatoId == rec.autore.id and utenteLoggato.stato != 'BANNATO')}"
	           th:href="@{'/recensione/' + ${rec.id} + '/delete'}"
	           class="delete-review-button">
	            Cancella recensione
	        </a>

			<!-- Link MODIFICA recensione: visibile solo all'autore -->
			<a th:if="${utenteLoggatoId == rec.autore.id and utenteLoggato.stato != 'BANNATO'}"
			   th:href="@{'/recensione/' + ${rec.id} + '/edit'}"
			   class="edit-review-button">
			    Modifica recensione
			</a>

	        <hr>
	    </div>

	</div>

	<div th:if="${ricetta.recensioni == null or #lists.isEmpty(ricetta.recensioni)}">
	    <p>Nessuna recensione presente.</p>
	</div>

    <a th:href="@{/}" class="back-home-link">Torna alla Home</a>

  </div>
</body>

</html>
