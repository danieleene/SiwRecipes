<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Nuova Ricetta</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>

<div class="page-wrapper">

    <div class="form-card">

        <h1 class="form-title">Inserisci una Nuova Ricetta</h1>

		<form th:action="@{/ricetta}" method="post" th:object="${ricetta}" class="form-content">

            
            <div class="form-group">
                <label for="titolo">Nome della ricetta</label>
                <input type="text" id="titolo" th:field="*{titolo}" required>
            </div>

            <div class="form-group">
                <label for="descrizione">Descrizione</label>
                <textarea id="descrizione" th:field="*{descrizione}" required></textarea>
            </div>
			
			<div class="form-group">
				<label for="procedimento">Procedimento</label>
				<textarea id="procedimento" th:field="*{procedimento}" required></textarea>
			</div>

            <div class="form-group">
                <label for="tempo">Tempo di preparazione (minuti)</label>
                <input type="number" id="tempo" th:field="*{tempo}" min="1" required>
            </div>

            <div class="form-group">
                <label for="difficolta">Difficoltà</label>
                <select id="difficolta" th:field="*{difficolta}">
                    <option value="FACILE">Facile</option>
                    <option value="MEDIA">Media</option>
                    <option value="DIFFICILE">Difficile</option>
                </select>
            </div>

			<div class="form-group">
				<label for="categoria">Categoria</label>
				<input type="text" id="categoria" th:field="*{categoria}"> 
			</div>


<!-- 
			<div class="form-group">
			    <label for="fileImmagine">Immagine della ricetta</label>
			    <input type="file" id="fileImmagine" name="fileImmagine" accept=".jpg,.jpeg">
			</div>
-->			

			
			<!-- ========================= -->
			<!--     SEZIONE INGREDIENTI   -->
			<!-- ========================= -->

			<h2 class="form-title">Ingredienti</h2>

			<div id="ingredienti-container">

			    <div th:each="ingrediente, iterStat : *{ingredienti}" class="ingrediente-item">

			        <div class="form-group">
			            <label>Nome ingrediente</label>
			            <input type="text"
			                   th:field="*{ingredienti[__${iterStat.index}__].nome}"
			                   placeholder="Es. Farina" required>
			        </div>

			        <div class="form-group">
			            <label>Quantità</label>
			            <input type="number" step="0.01"
			                   th:field="*{ingredienti[__${iterStat.index}__].quantita}"
			                   placeholder="Es. 200" required>
			        </div>

			        <div class="form-group">
			            <label>Unità di misura</label>
			            <input type="text"
			                   th:field="*{ingredienti[__${iterStat.index}__].unita}"
			                   placeholder="Es. g" required>
			        </div>

					<a href="#" class="delete-ingrediente">Cancella</a>

			        <hr>
			    </div>

			</div>

			<div class="btn-container">
			    <button type="button" id="add-ingrediente-btn" class="btn">+ Aggiungi ingrediente</button>
			</div>


			
            <div class="btn-container">
                <button type="submit" class="btn">Salva Ricetta</button>
            </div>
        </form>
		
		<!-- TEMPLATE NASCOSTO PER NUOVI INGREDIENTI -->
					<div id="ingrediente-template" class="ingrediente-item" style="display:none;">

					    <div class="form-group">
					        <label>Nome ingrediente</label>
					        <input type="text" name="ingredienti[IDX].nome" placeholder="Es. Farina" >
					    </div>

					    <div class="form-group">
					        <label>Quantità</label>
					        <input type="number" step="0.01" name="ingredienti[IDX].quantita" placeholder="Es. 200" >
					    </div>

					    <div class="form-group">
					        <label>Unità di misura</label>
					        <input type="text" name="ingredienti[IDX].unita" placeholder="Es. g" >
					    </div>

						<a href="#" class="delete-ingrediente">Cancella</a>

					    <hr>
					</div>

        <a th:href="@{/}" class="back-link">Torna alla Home</a>

    </div>

</div>
<script>
    const container = document.getElementById("ingredienti-container");
    const template = document.getElementById("ingrediente-template");
    const addBtn = document.getElementById("add-ingrediente-btn");

    addBtn.addEventListener("click", () => {
		const index = container.querySelectorAll(".ingrediente-item").length;


        // clona il template
        const clone = template.cloneNode(true);
        clone.style.display = "block";

        // aggiorna gli indici nei name=""
        clone.innerHTML = clone.innerHTML.replaceAll("IDX", index);

        // aggiungi al container
        container.appendChild(clone);
    });
</script>


</body>
</html>
